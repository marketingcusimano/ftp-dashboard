
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard B2B - Rete Commerciale ‚Ä¢ Cotto Cusimano</title>

  <!-- Tailwind CSS (no eval) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#2563eb",
            success: "#10b981",
            warning: "#f59e0b",
            danger:  "#ef4444",
          }
        }
      }
    }
  </script>

  <!-- React & ReactDOM (UMD, no Babel) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Recharts UMD -->
  <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.min.js"></script>

  <style>
    body { background:#ffffff; font-family: Inter, Segoe UI, Roboto, system-ui, -apple-system, sans-serif; }
  </style>
</head>
<body class="min-h-screen">
  <div id="root"></div>

  <script>
    // ---------- Utilities & Live Data ----------
    const itNum = (v) => (typeof v === 'number') ? v : Number(String(v||'').replace(/\./g,'').replace(',', '.')) || 0;
    const formatEuro = (v) => new Intl.NumberFormat('it-IT', { style:'currency', currency:'EUR' }).format(v||0);
    const formatPercent = (v) => (typeof v === 'number') ? (v.toFixed(2).replace('.', ',') + '%') : '‚Äî';
    const formatNumber = (v) => new Intl.NumberFormat('it-IT').format(v||0);
    const getColorByPerformance = (p) => (p>=90 ? '#10b981' : p>=70 ? '#f59e0b' : '#ef4444');

    function buildDashboardData(apiJson){
      const rows = Array.isArray(apiJson?.rows) ? apiJson.rows : [];
      const updatedAt = apiJson?.updatedAt || null;

      const agentKey = (r) => (r.Agente_Codice || '‚Äî') + '|' + (r.Agente_Nome || '‚Äî');
      const agentsSet = new Set(rows.map(agentKey));
      const agentIds = Array.from(agentsSet);

      const byTipo = (t) => rows.filter(r => r.Tipo_Dato === t);
      const OBI = byTipo('OBIETTIVI');
      const OBI_GEN = OBI.filter(r => r.Provincia === 'Generale');
      const OBI_PROV = OBI.filter(r => r.Provincia && r.Provincia !== 'Generale');
      const VEND = byTipo('VENDITE_CLIENTE');
      const CLIP = byTipo('CLIENTI_PROVINCIA');
      const TOT = byTipo('TOTALE');

      let fatturatoTot = 0;
      const totFattRows = TOT.filter(r => r.Descrizione === 'Fatturato_Totale');
      if (totFattRows.length > 0){
        fatturatoTot = totFattRows.reduce((s,r)=> s + itNum(r.Valore), 0);
      } else {
        fatturatoTot = VEND.reduce((s,r)=> s + itNum(r.Fatturato), 0);
      }
      let clientiTot = 0;
      const totCliRows = TOT.filter(r => r.Descrizione === 'Clienti_Totale');
      if (totCliRows.length > 0){
        clientiTot = totCliRows.reduce((s,r)=> s + itNum(r.Valore), 0);
      } else {
        clientiTot = CLIP.reduce((s,r)=> s + itNum(r.Clienti_Serviti), 0);
      }

      const agentiAttivi = agentIds.length;
      const sommaAC = OBI_GEN.reduce((s,r)=> s + itNum(r.Anno_Corrente), 0);
      const sommaOb = OBI_GEN.reduce((s,r)=> s + itNum(r.Obiettivo), 0);
      const percentOb = sommaOb > 0 ? (sommaAC / sommaOb) * 100 : 0;
      const sommaAP = OBI_GEN.reduce((s,r)=> s + itNum(r.Anno_Precedente), 0);
      const yoy = sommaAP > 0 ? ((sommaAC - sommaAP) / sommaAP) * 100 : 0;

      const agenti = agentIds.map(key => {
        const [codice, nome] = key.split('|');
        const vendAg = VEND.filter(r => agentKey(r) === key);
        const clipAg = CLIP.filter(r => agentKey(r) === key);
        const obiGenAg = OBI_GEN.find(r => agentKey(r) === key) || {};
        const perProvFatt = {};
        vendAg.forEach(r => {
          const p = r.Provincia || '‚Äî';
          perProvFatt[p] = (perProvFatt[p] || 0) + itNum(r.Fatturato);
        });
        const perProvCli = {};
        clipAg.forEach(r => {
          const p = r.Provincia || '‚Äî';
          perProvCli[p] = (perProvCli[p] || 0) + itNum(r.Clienti_Serviti);
        });
        const clientiperprov = Object.keys(perProvFatt).map(p => ({
          provincia: p,
          fatturato: perProvFatt[p],
          clienti: perProvCli[p] || 0
        }));

        return {
          codice,
          ragione_sociale: nome,
          periodo: null,
          obiettivi: { generale: {} },
          clienti_per_provincia: clientiperprov.sort((a,b)=> b.fatturato - a.fatturato),
          totali: {
            fatturato_corrente: itNum(obiGenAg.Anno_Corrente),
            fatturato_precedente: itNum(obiGenAg.Anno_Precedente),
            clienti_serviti: clipAg.reduce((s,r)=> s + itNum(r.Clienti_Serviti), 0),
            obiettivo: itNum(obiGenAg.Obiettivo),
            percentuale_obiettivo: itNum(obiGenAg.Percentuale_Obiettivo)
          }
        };
      });

      const provKeys = new Set(rows.map(r => r.Provincia).filter(Boolean).map(String));
      const province = Array.from(provKeys).map(p => {
        const vendP = VEND.filter(r => r.Provincia === p);
        const clipP = CLIP.filter(r => r.Provincia === p);
        const obiP  = OBI_PROV.filter(r => r.Provincia === p);

        const fatt = vendP.reduce((s,r)=> s + itNum(r.Fatturato), 0);
        const clients = clipP.reduce((s,r)=> s + itNum(r.Clienti_Serviti), 0);
        const agSet = new Set( vendP.concat(clipP).concat(obiP).map(agentKey) );

        const somAC = obiP.reduce((s,r)=> s + itNum(r.Anno_Corrente), 0);
        const somOb = obiP.reduce((s,r)=> s + itNum(r.Obiettivo), 0);
        const perc = somOb > 0 ? (somAC / somOb) * 100 : 0;

        return {
          provincia: p,
          fatturato_totale: fatt,
          clienti_totali: clients,
          numero_agenti: agSet.size,
          obiettivo_totale: somOb,
          percentuale_obiettivo: perc
        };
      }).sort((a,b)=> b.fatturato_totale - a.fatturato_totale);

      return {
        riepilogo_generale: {
          fatturato_totale: fatturatoTot,
          percentuale_obiettivo: percentOb,
          clienti_totali: clientiTot,
          agenti_attivi: agentiAttivi,
          variazione_yoy: yoy,
          aggiornato_il: updatedAt
        },
        agenti,
        province
      };
    }

    async function loadLiveData(){
      try{
        const res = await fetch('/data', { cache:'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const api = await res.json();
        window.dashboardData = buildDashboardData(api);
      }catch(e){
        console.warn('Live /data non disponibile, uso dataset demo.', e);
        window.dashboardData = window.dashboardData || {
          riepilogo_generale: {
            fatturato_totale: 0,
            percentuale_obiettivo: 0,
            clienti_totali: 0,
            agenti_attivi: 0,
            variazione_yoy: 0,
            aggiornato_il: new Date().toISOString()
          },
          agenti: [], province: []
        };
      }
    }

    // ---------- React components (no JSX) ----------
    function Header(props){
      return React.createElement("header", {className:"border-b border-gray-100 bg-white"},
        React.createElement("div", {className:"max-w-7xl mx-auto px-4 py-6 grid grid-cols-1 md:grid-cols-3 gap-4 items-center"},
          React.createElement("div",{className:"flex items-center gap-3"},
            React.createElement("div",{className:"w-11 h-11 rounded-xl bg-gradient-to-br from-primary to-blue-400 flex items-center justify-center text-white font-bold"},"CC"),
            React.createElement("div",null,
              React.createElement("div",{className:"font-semibold"},"Cotto Cusimano"),
              React.createElement("div",{className:"text-xs text-gray-500"},"Rete commerciale B2B")
            )
          ),
          React.createElement("div",{className:"text-center"},
            React.createElement("h1",{className:"text-xl md:text-2xl font-bold"},"Dashboard Performance Agenti"),
            React.createElement("div",{className:"text-xs text-gray-500 mt-1"},"Ultimo aggiornamento: ",
              React.createElement("span",{className:"font-medium"}, props.updatedAt || "‚Äî")
            )
          ),
          React.createElement("div",{className:"flex md:justify-end gap-2"},
            React.createElement("button",{className:"px-3 py-2 rounded-xl border border-gray-200", onClick:()=>window.print()},"Stampa")
          )
        )
      );
    }

    function KPICard(props){
      const color = props.color || "text-primary";
      const icon = props.icon || "‚óè";
      const children = [
        React.createElement("div",{className:"flex justify-between items-start", key:"row"},
          React.createElement("div",{className:"text-sm text-gray-500"}, props.label || ""),
          React.createElement("div",{className:"text-xs px-2 py-0.5 rounded-full border " + color, style:{borderColor:"currentColor"}}, icon)
        ),
        React.createElement("div",{className:"text-2xl font-bold mt-1", key:"val"}, props.value || "‚Äî")
      ];
      if (typeof props.delta === "number"){
        children.push(
          React.createElement("div",{className:"mt-1 text-sm", key:"delta"},
            (props.delta >= 0)
              ? React.createElement("span",{className:"text-success"}, "‚ñ≤ " + props.delta.toFixed(1) + "%")
              : React.createElement("span",{className:"text-danger"}, "‚ñº " + Math.abs(props.delta).toFixed(1) + "%"),
            React.createElement("span",{className:"text-gray-400 ml-1"},"vs prec.")
          )
        );
      }
      if (props.hint){
        children.push(React.createElement("div",{className:"mt-1 text-xs text-gray-500", key:"hint"}, props.hint));
      }
      return React.createElement("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md p-6"}, children);
    }

    function Gauge(props){
      const percent = Math.max(0, Math.min(100, props.percent||0));
      const color = getColorByPerformance(percent);
      const rest = 100 - percent;
      const R = Recharts;
      return React.createElement(R.ResponsiveContainer,{width:"100%", height:220},
        React.createElement(R.PieChart,null,
          React.createElement(R.Pie,{
            data:[{value:percent},{value:rest}], startAngle:180, endAngle:0,
            innerRadius:70, outerRadius:100, dataKey:"value"
          },
            React.createElement(R.Cell,{fill:color}),
            React.createElement(R.Cell,{fill:"#eee"})
          ),
          React.createElement("text",{x:"50%", y:"60%", textAnchor:"middle", dominantBaseline:"middle", className:"fill-gray-700", style:{fontSize:24, fontWeight:700}}, formatPercent(percent)),
          React.createElement("text",{x:"50%", y:"78%", textAnchor:"middle", dominantBaseline:"middle", className:"fill-gray-500", style:{fontSize:12}},"Raggiungimento obiettivo")
        )
      );
    }

    function App(){
      const R = Recharts;
      const ReactHooks = React;
      const useState = ReactHooks.useState;
      const useMemo = ReactHooks.useMemo;

      const data = window.dashboardData || { riepilogo_generale:{}, agenti:[], province:[] };
      const _kpi = data.riepilogo_generale || {};

      const [tab, setTab] = useState('panoramica');
      const [provSel, setProvSel] = useState('');
      const [agSel, setAgSel] = useState('');

      const updatedAt = useMemo(function(){
        const d = _kpi.aggiornato_il;
        try { return new Date(d).toLocaleString('it-IT'); } catch(e){ return '‚Äî'; }
      }, [data]);

      const agenti = useMemo(function(){
        return (data.agenti||[]).map(function(a){
          return {
            codice:a.codice, nome:a.ragione_sociale,
            fatturato:a?.totali?.fatturato_corrente||0,
            clienti:a?.totali?.clienti_serviti||0,
            obiettivo:a?.totali?.obiettivo||0,
            perc:a?.totali?.percentuale_obiettivo||0,
            perProvincia:a?.clienti_per_provincia||[],
            precedente:a?.totali?.fatturato_precedente||0
          };
        });
      }, [data]);

      const province = useMemo(function(){ return data.province||[]; }, [data]);

      const topAgenti = useMemo(function(){
        return agenti.slice().sort(function(a,b){ return (b.fatturato||0)-(a.fatturato||0); }).slice(0,10);
      }, [agenti]);

      const topProv = useMemo(function(){
        return province.slice().sort(function(a,b){ return (b.fatturato_totale||0)-(a.fatturato_totale||0); }).slice(0,10)
          .map(function(p){ return { provincia:p.provincia, fatturato:p.fatturato_totale }; });
      }, [province]);

      const filteredAgentiInProv = useMemo(function(){
        if (!provSel) return agenti;
        return agenti.filter(function(a){ return (a.perProvincia||[]).some(function(pp){ return pp.provincia===provSel; }); });
      }, [agenti, provSel]);

      const agenteCorrente = useMemo(function(){
        if (!agSel) return agenti[0];
        return agenti.find(function(a){ return a.codice===agSel || a.nome===agSel; }) || agenti[0];
      }, [agenti, agSel]);

      // ---------- UI Sections (no JSX) ----------
      function Tabs(){
        return React.createElement("div",{className:"flex gap-2 mb-6"},
          React.createElement("button",{className:"px-4 py-2 rounded-full border " + (tab==='panoramica'?'bg-primary text-white border-primary':'border-gray-200'), onClick:function(){ setTab('panoramica'); }},"Panoramica Generale"),
          React.createElement("button",{className:"px-4 py-2 rounded-full border " + (tab==='regioni'?'bg-primary text-white border-primary':'border-gray-200'), onClick:function(){ setTab('regioni'); }},"Regioni"),
          React.createElement("button",{className:"px-4 py-2 rounded-full border " + (tab==='agenti'?'bg-primary text-white border-primary':'border-gray-200'), onClick:function(){ setTab('agenti'); }},"Agenti")
        );
      }

      function Panoramica(){
        return React.createElement("section",{className:"space-y-6"},
          // KPI row
          React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6"},
            React.createElement(KPICard,{label:"Fatturato Totale Rete", value:formatEuro(_kpi.fatturato_totale||0), icon:"‚Ç¨"}),
            React.createElement(KPICard,{label:"% Raggiungimento Obiettivo", value:formatPercent(_kpi.percentuale_obiettivo||0), icon:"üéØ", color:"text-success"}),
            React.createElement(KPICard,{label:"Clienti Totali", value:formatNumber(_kpi.clienti_totali||0), icon:"üë•", color:"text-primary"}),
            React.createElement(KPICard,{label:"Agenti Attivi", value:formatNumber(_kpi.agenti_attivi||0), icon:"üßë‚Äçüíº", color:"text-primary"}),
            React.createElement(KPICard,{label:"Variazione YoY", value:formatPercent(Math.abs(_kpi.variazione_yoy||0)), icon:"‚Üï", color:(_kpi.variazione_yoy||0)>=0?'text-success':'text-danger', delta:_kpi.variazione_yoy||0})
          ),
          // Charts row
          React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6"},
            React.createElement("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md p-6"},
              React.createElement("div",{className:"font-semibold mb-2"},"Top 10 Agenti per Fatturato"),
              React.createElement("div",{className:"h-72"},
                React.createElement(R.ResponsiveContainer,{width:"100%", height:"100%"},
                  React.createElement(R.BarChart,{data:topAgenti},
                    React.createElement(R.CartesianGrid,{stroke:"#eee"}),
                    React.createElement(R.XAxis,{type:"number", tickFormatter:formatEuro}),
                    React.createElement(R.YAxis,{type:"category", dataKey:"nome", width:120}),
                    React.createElement(R.Tooltip,{formatter:function(v){ return formatEuro(v); }}),
                    React.createElement(R.Bar,{dataKey:"fatturato"},
                      topAgenti.map(function(a,i){
                        return React.createElement(R.Cell,{key:i, fill:"hsl(" + (20 + i*6) + ",70%,50%)"});
                      })
                    )
                  )
                )
              )
            ),
            React.createElement("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md p-6"},
              React.createElement("div",{className:"font-semibold mb-2"},"Raggiungimento Obiettivo Generale"),
              React.createElement(Gauge,{percent:_kpi.percentuale_obiettivo||0})
            )
          ),
          // Province top 10
          React.createElement("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md p-6"},
            React.createElement("div",{className:"font-semibold mb-2"},"Fatturato per Provincia (Top 10)"),
            React.createElement("div",{className:"h-80"},
              React.createElement(R.ResponsiveContainer,{width:"100%", height:"100%"},
                React.createElement(R.BarChart,{data:topProv},
                  React.createElement(R.CartesianGrid,{stroke:"#eee"}),
                  React.createElement(R.XAxis,{dataKey:"provincia"}),
                  React.createElement(R.YAxis,{tickFormatter:formatEuro}),
                  React.createElement(R.Tooltip,{formatter:function(v){ return formatEuro(v); }}),
                  React.createElement(R.Bar,{dataKey:"fatturato", fill:"#2563eb"})
                )
              )
            )
          ),
          // Metriche medie
          React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6"},
            React.createElement("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md p-6"},
              React.createElement("div",{className:"text-sm text-gray-500"},"Fatturato medio per agente"),
              React.createElement("div",{className:"text-2xl font-bold mt-1"}, formatEuro((_kpi.fatturato_totale||0)/Math.max(1,(_kpi.agenti_attivi||1))))
            ),
            React.createElement("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md p-6"},
              React.createElement("div",{className:"text-sm text-gray-500"},"Clienti medi per agente"),
              React.createElement("div",{className:"text-2xl font-bold mt-1"}, formatNumber((_kpi.clienti_totali||0)/Math.max(1,(_kpi.agenti_attivi||1))))
            ),
            React.createElement("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md p-6"},
              React.createElement("div",{className:"text-sm text-gray-500"},"Fatturato medio per cliente"),
              React.createElement("div",{className:"text-2xl font-bold mt-1"}, formatEuro((_kpi.fatturato_totale||0)/Math.max(1,(_kpi.clienti_totali||1))))
            )
          )
        );
      }

      function Regioni(){
        const [dummy, setDummy] = React.useState(0); // force update for select
        return React.createElement("section",{className:"space-y-6"},
          React.createElement("div",{className:"flex flex-col md:flex-row gap-3"},
            React.createElement("select",{className:"px-3 py-2 rounded-xl border border-gray-200", value:provSel, onChange:function(e){ setProvSel(e.target.value); setDummy(dummy+1);} },
              React.createElement("option",{value:""},"Tutte le Province"),
              province.map(function(p){ return React.createElement("option",{key:p.provincia, value:p.provincia}, p.provincia); })
            ),
            React.createElement("button",{className:"px-3 py-2 rounded-xl border border-gray-200", onClick:function(){ setProvSel(""); setDummy(dummy+1);} },"Reset")
          ),
          (function(){
            if (!provSel) return null;
            const P = province.find(function(p){ return p.provincia===provSel; });
            if (!P) return null;
            return React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6"},
              React.createElement(KPICard,{label:"Fatturato Provincia", value:formatEuro(P.fatturato_totale||0), icon:"‚Ç¨"}),
              React.createElement(KPICard,{label:"Agenti operanti", value:formatNumber(P.numero_agenti||0), icon:"üßë‚Äçüíº"}),
              React.createElement(KPICard,{label:"Clienti totali", value:formatNumber(P.clienti_totali||0), icon:"üë•"}),
              React.createElement(KPICard,{label:"% Obiettivo", value:formatPercent(P.percentuale_obiettivo||0), icon:"üéØ", color:"text-success"})
            );
          })(),
          React.createElement("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md p-6"},
            React.createElement("div",{className:"font-semibold mb-2"},"Fatturato per Provincia (tutte)"),
            React.createElement("div",{className:"h-96"},
              React.createElement(R.ResponsiveContainer,{width:"100%", height:"100%"},
                React.createElement(R.BarChart,{data: province.slice().sort(function(a,b){return (b.fatturato_totale||0)-(a.fatturato_totale||0);})},
                  React.createElement(R.CartesianGrid,{stroke:"#eee"}),
                  React.createElement(R.XAxis,{dataKey:"provincia", interval:0, angle:-45, textAnchor:"end", height:80}),
                  React.createElement(R.YAxis,{tickFormatter:formatEuro}),
                  React.createElement(R.Tooltip,{formatter:function(v){ return formatEuro(v); }}),
                  React.createElement(R.Bar,{dataKey:"fatturato_totale"},
                    province.slice().sort(function(a,b){return (b.fatturato_totale||0)-(a.fatturato_totale||0);}).map(function(p,i){
                      return React.createElement(R.Cell,{key:i, fill:getColorByPerformance(p.percentuale_obiettivo||0)});
                    })
                  )
                )
              )
            )
          ),
          React.createElement("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md p-6"},
            React.createElement("div",{className:"font-semibold mb-2"},"Clienti vs Fatturato (per Provincia)"),
            React.createElement("div",{className:"h-96"},
              React.createElement(R.ResponsiveContainer,{width:"100%", height:"100%"},
                React.createElement(R.ScatterChart,null,
                  React.createElement(R.CartesianGrid,{stroke:"#eee"}),
                  React.createElement(R.XAxis,{type:"number", dataKey:"x", name:"Clienti"}),
                  React.createElement(R.YAxis,{type:"number", dataKey:"y", name:"Fatturato", tickFormatter:formatEuro}),
                  React.createElement(R.Tooltip,{formatter:function(v,name){ return name==='y'?formatEuro(v):formatNumber(v); }, labelFormatter:function(_,i){ return (province[i]||{}).provincia; }}),
                  React.createElement(R.Scatter,{data: province.map(function(p){ return {x:p.clienti_totali||0, y:p.fatturato_totale||0}; }), fill:"#2563eb"})
                )
              )
            )
          )
        );
      }

      function Agenti(){
        const [dummy, setDummy] = React.useState(0);
        return React.createElement("section",{className:"space-y-6"},
          React.createElement("div",{className:"flex flex-col md:flex-row gap-3"},
            React.createElement("select",{className:"px-3 py-2 rounded-xl border border-gray-200", value:agSel, onChange:function(e){ setAgSel(e.target.value); setDummy(dummy+1);} },
              agenti.map(function(a){ return React.createElement("option",{key:a.codice, value:a.codice}, a.codice + " ‚Äî " + a.nome); })
            )
          ),
          (function(){
            const a = agenteCorrente;
            if (!a) return null;
            return React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-6"},
              React.createElement(KPICard,{label:"Fatturato A.C.", value:formatEuro(a.fatturato||0), icon:"‚Ç¨"}),
              React.createElement(KPICard,{label:"Obiettivo", value:formatEuro(a.obiettivo||0), icon:"üéØ"}),
              React.createElement(KPICard,{label:"% Raggiungimento", value:formatPercent(a.perc||0), icon:"‚úì", color:"text-success"}),
              React.createElement(KPICard,{label:"Clienti Serviti", value:formatNumber(a.clienti||0), icon:"üë•"}),
              React.createElement(KPICard,{label:"Variazione YoY", value:formatPercent(((a.fatturato||0)-(a.precedente||0))/Math.max(1,(a.precedente||0))*100 || 0), icon:"‚Üï", color:((a.fatturato||0)-(a.precedente||0))>=0?'text-success':'text-danger'}),
              React.createElement(KPICard,{label:"Province coperte", value:formatNumber((a.perProvincia||[]).length), icon:"üó∫Ô∏è"})
            );
          })(),
          React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6"},
            React.createElement("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md p-6"},
              React.createElement("div",{className:"font-semibold mb-2"},"Fatturato per Provincia (Agente)"),
              React.createElement("div",{className:"h-80"},
                React.createElement(R.ResponsiveContainer,{width:"100%", height:"100%"},
                  React.createElement(R.BarChart,{data: (agenteCorrente?.perProvincia||[]).slice().sort(function(a,b){ return (b.fatturato||0)-(a.fatturato||0); })},
                    React.createElement(R.CartesianGrid,{stroke:"#eee"}),
                    React.createElement(R.XAxis,{dataKey:"provincia"}),
                    React.createElement(R.YAxis,{tickFormatter:formatEuro}),
                    React.createElement(R.Tooltip,{formatter:function(v){ return formatEuro(v); }}),
                    React.createElement(R.Bar,{dataKey:"fatturato", fill:"#2563eb"})
                  )
                )
              )
            ),
            React.createElement("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md p-6"},
              React.createElement("div",{className:"font-semibold mb-2"},"Performance vs Obiettivo"),
              React.createElement("div",{className:"h-60"},
                React.createElement(R.ResponsiveContainer,{width:"100%", height:"100%"},
                  React.createElement(R.PieChart,null,
                    React.createElement(R.Pie,{data:[{value:(agenteCorrente?.perc||0)},{value:100-(agenteCorrente?.perc||0)}], startAngle:180, endAngle:0, innerRadius:70, outerRadius:100, dataKey:"value"},
                      React.createElement(R.Cell,{fill:getColorByPerformance(agenteCorrente?.perc||0)}),
                      React.createElement(R.Cell,{fill:"#eee"})
                    ),
                    React.createElement("text",{x:"50%", y:"60%", textAnchor:"middle", dominantBaseline:"middle", className:"fill-gray-700", style:{fontSize:24, fontWeight:700}}, formatPercent(agenteCorrente?.perc||0))
                  )
                )
              )
            )
          ),
          React.createElement("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md p-6"},
            React.createElement("div",{className:"font-semibold mb-2"},"Top Province (Distribuzione Fatturato)"),
            React.createElement("div",{className:"h-80"},
              React.createElement(R.ResponsiveContainer,{width:"100%", height:"100%"},
                React.createElement(R.PieChart,null,
                  React.createElement(R.Pie,{
                      data:(agenteCorrente?.perProvincia||[]).slice().sort(function(a,b){return b.fatturato-a.fatturato;}).slice(0,5),
                      dataKey:"fatturato", nameKey:"provincia", cx:"50%", cy:"50%", outerRadius:120, label:true
                    },
                    (agenteCorrente?.perProvincia||[]).slice(0,5).map(function(_,i){
                      return React.createElement(R.Cell,{key:i, fill:"hsl("+ (200 + i*25) +",70%,50%)"});
                    })
                  ),
                  React.createElement(R.Tooltip,{formatter:function(v){ return formatEuro(v); }})
                )
              )
            )
          )
        );
      }

      const container = React.createElement("div", null,
        React.createElement(Header,{updatedAt: updatedAt}),
        React.createElement("main",{className:"max-w-7xl mx-auto px-4 py-8"},
          React.createElement(Tabs,null),
          (function(){
            if (tab==='panoramica') return React.createElement(Panoramica,null);
            if (tab==='regioni') return React.createElement(Regioni,null);
            return React.createElement(Agenti,null);
          })()
        )
      );

      return container;
    }

    async function bootstrap(){
      await loadLiveData();
      function mountWhenReady(){
        if (typeof Recharts === 'undefined') {
          setTimeout(mountWhenReady, 50);
          return;
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
      }
      mountWhenReady();
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', bootstrap);
    } else {
      bootstrap();
    }
  </script>
</body>
</html>
